<html><head><meta name="viewport" content="width=device-width, initial-scale=1"><link href=//fonts.googleapis.com/css?family=Raleway:400,300,600 rel=stylesheet type=text/css><link rel="stylesheet" type="text/css" href="../common/css/normalize.css"><link rel="stylesheet" type="text/css" href="../common/css/skeleton.css"><link rel="stylesheet" type="text/css" href="../common/css/wiki.css"><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><title>Intel® Edison and Grove IoT Starter Kit Powered by AWS</title><meta charset="utf-8"/></head><body><div class"container"><a href="../index.html"><img src="../common/logo.png"/></a></div><div class="mw-content-ltr container" dir="ltr" id="mw-content-text" lang="en"><h1>Intel® Edison and Grove IoT Starter Kit Powered by AWS</h1><div class="thumb tright"><div class="thumbinner" style="width:502px;"><img src="img/Aws_kit_wiki_cover.JPG" width="500"/> <div class="thumbcaption"></div></div></div>
<p><i>Main articles: Start here <a href="/Grove_IoT_Starter_Kits_Powered_by_AWS" title="Grove IoT Starter Kits Powered by AWS">Grove IoT Starter Kits Powered by AWS</a> , <a href="https://software.intel.com/en-us/iot/library/edison-getting-started">Intel Edison</a></i>
</p><p>Designed for expert makers, entrepreneurs, and industrial IoT companies, the Intel Edison module provides easier prototyping with a fully open source hardware and software development environment. It supports Wi-Fi and BLE 4.0 connectivity. This kit contains eleven selective Grove sensors and actuators for you to track indoor environment as well as to create smart-house applications.
</p><p><br/>
<a href="http://www.amazon.com/dp/B0168KU5FK"><img src="../common/Get_One_Now_Banner.png" width="300"/></a>
</p><p><br/>
</p>
<p><br/>
</p>
<h2> Included in the Box</h2>
<div class="thumb tright"><div class="thumbinner" style="width:602px;"><img src="img/Aws_kit_edison.JPG" width="600"/> <div class="thumbcaption"></div></div></div>
<table>
<tr>
<th> Board/Part </th>
<th> Qty </th>
<th> Documentation
</th></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Intel-Edison-for-Arduino-p-2149.html">Intel® Edison for Arduino</a> </td>
<td> 1 </td>
<td> <a href="https://software.intel.com/en-us/iot/library/edison-getting-started">Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Base-Shield-V2-p-1378.html?cPath=98_16">Base Shield</a> </td>
<td> 1 </td>
<td> <a href="/Base_shield_v2" title="Base shield v2"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-TemperatureHumidity-Sensor-HighAccuracy-Mini-p-1921.html?cPath=25_125">Grove - Temperature&amp;Humidity Sensor (High-Accuracy &amp; Mini)</a> </td>
<td> 1 </td>
<td> <a href="/Grove-TemptureAndHumidity_Sensor-High-Accuracy_AndMini-v1.0" title="Grove - Tempture&amp;Humidity Sensor (High-Accuracy &amp;Mini) v1.0"> Read Here</a>
</td></tr>
<tr>
<td> <a href="http://www.seeedstudio.com/depot/Grove-Moisture-Sensor-p-955.html?cPath=25_27">Grove - Moisture Sensor</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Moisture_Sensor" title="Grove - Moisture Sensor"> Read Here</a>
</td></tr>
<tr>
<td> <a href="http://www.seeedstudio.com/depot/Grove-Light-Sensor-p-746.html?cPath=25_27">Grove - Light Sensor</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Light_Sensor" title="Grove - Light Sensor"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-UV-Sensor-p-1540.html?cPath=25_27">Grove - UV Sensor</a> </td>
<td> 1 </td>
<td> <a href="/Grove-UV_Sensor" title="Grove - UV Sensor"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-PIR-Motion-Sensor-p-802.html?cPath=25_31">Grove - PIR Motion Sensor</a> </td>
<td>1 </td>
<td> <a href="/Grove-PIR_Motion_Sensor" title="Grove - PIR Motion Sensor"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Encoder-p-1352.html?cPath=85_52">Grove - Encoder</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Encoder" title="Grove - Encoder"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Button-p-766.html">Grove - Button</a></td>
<td> 1 </td>
<td> <a href="/Grove-Button" title="Grove - Button"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-LCD-RGB-Backlight-p-1643.html?cPath=34_36">Grove - LCD RGB Backlight</a> </td>
<td> 1 </td>
<td> <a href="/Grove-LCD_RGB_Backlight" title="Grove - LCD RGB Backlight"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Relay-p-769.html?cPath=39_42">Grove - Relay</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Relay" title="Grove - Relay"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Servo-p-1241.html?cPath=39_41">Grove - Servo</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Servo" title="Grove - Servo"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Buzzer-p-768.html?cPath=38">Grove - Buzzer</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Buzzer" title="Grove - Buzzer"> Read Here</a>
</td></tr>
<tr>
<td>USB Cable; 480mm-Black</td>
<td>1 </td>
<td>
</td></tr>
<tr>
<td> USB Wall Power Supply </td>
<td> 1 </td>
<td>
</td></tr></table>
<p><br/>
<br/>
</p>
<h2> Features </h2>
<ul><li> Out-of-the-box, plug and play, no breadboard or soldering work required.
</li><li> Fully compliant with AWS's services and AWS's practices.
</li><li> Step-by-step tutorials for developers and makers for quicker prototyping.
</li></ul>
<p><br/>
</p>
<h2> Getting Started </h2>
<h3>  Configure Your AWS IoT Service </h3>
<ul><li> Visit amazone  <a href="http://console.aws.amazon.com">AWS console</a>, register and logon your account.
</li></ul>
<dl><dd>1. Goto the dashboard, click Service --&gt; AWS IoT
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_click_iot.png" width="600"/>
</p>
<dl><dd>2. Click Get started
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_click_get_started.jpg" width="600"/>
<br/>
</p>
<dl><dd>3. Create a new user
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_create_a_new_user.png" width="600"/>
<br/>
<img src="img/AWS_LinkIt_starter_kit_create_a_new_user2.png" width="600"/>
<br/>
<img src="img/AWS_LinkIt_starter_kit_create_a_new_user3.png" width="384"/>
<br/>
</p>
<dl><dd>4. Save user name and download Security Credentials
</dd></dl>
<p><img src="img/AWS_Edison_starter_kit_get_Security_Credentials1.png" width="600"/>
<br/>
<img src="img/AWS_Edison_starter_kit_get_Security_Credentials2.png" width="400"/>
</p>
<dl><dd>5.Seeting Attach Policy with AdministratorAccess
</dd></dl>
<p><img src="img/AWS_Edison_starter_kit_get_Security_Credentials3.png" width="400"/>
<br/>
<img src="img/AWS_Edison_starter_kit_get_Security_Credentials4.png" width="400"/>
<br/>
</p>
<dl><dd>6.Create a thing
</dd></dl>
<p>At this section you can also refer to the <a href="/Beagle_Bone_Green_and_Grove_IoT_Starter_Kit_Powered_by_AWS">Beagle Bone wiki</a> for another way to create a thing and finish the left tasks. The difference is Beagle Bone didn’t use AWS CLI tool to Get Certifications.
<br/>
</p><p><img src="img/AWS_Edison_starter_kit_create_a_thing1.png" width="400"/>
<br/>
<img src="img/AWS_Edison_starter_kit_create_a_thing2.png" width="400"/>
<br/>
</p>
<h3>  Setting up AW IoT device SDK on the intel edison board </h3>
<p><b>Before you begin</b>
</p>
<ul><li> Make sure you have run the configure_edison --setup command to set up your board
</li><li> Make sure your Intel® Edison board is online via your local Wi-Fi network (should occur during configure_edison setup)
</li><li> Login ediosn console with ssh(Use putty or Xshell).
</li></ul>
<p><b>Install AWS CLI </b><br/>
The AWS CLI is a way to manage your AWS services from your board.  You need this first in order to download the SDK.
</p><p>1.First, you need to install pip (Python package manager):
</p>
<pre>
curl https://bootstrap.pypa.io/ez_setup.py -o - | python
easy_install pip
</pre>
<p>2.Next, install the AWS CLI with pip:
</p>
<pre>
pip install awscli
</pre>
<p>Note: In order to view the help files ("aws iot help") you need to install Groff and  a non-BusyBox version of less.
</p><p>3.For Groff:
</p>
<pre>
wget http://ftp.gnu.org/gnu/groff/groff-1.22.3.tar.gz
tar -zxvf groff-1.22.3.tar.gz
cd groff-1.22.3
./configure
make
make install
export PATH=$PATH:/usr/local/bin/
cd ~
</pre>
<p>4.For Less:
First rename the old version of less
</p>
<pre>
mv /usr/bin/less /usr/bin/less-OLD
Then install the new version of less
wget http://www.greenwoodsoftware.com/less/less-458.zip
unzip less-458.zip
cd less-458
chmod 777 *
./configure
make
make install
cd ~
</pre>
<p>5.To make sure everything has installed correctly, run the iot help file:
</p>
<pre>
aws iot help
</pre>
<p><br/>
<b>Get AWS credentials:</b>
<br/>
At this point, you should have AWS CLI installed. And the Access ID and Key you have download before, configure AWS and enter the ID and Key with:  
</p>
<pre>
aws configure
</pre>
<p><img src="img/AWS_Edison_starter_kit_get_aws_cli1.png" width="600"/>
<img src="img/AWS_Edison_starter_kit_get_aws_cli2.png" width="571"/>
<br/>
</p><p>1.First create a folder to store your certificates in:
<br/>
</p>
<pre>
$ mkdir aws_certs
$ cd aws_certs
</pre>
<p>2.Generate a private key with open ssl:
</p>
<pre>
openssl genrsa -out privateKey.pem 2048
openssl req -new -key privateKey.pem -out cert.csr
</pre>
<p>3.Fill out the fields with your info. <br/>
<img src="img/AWS_Edison_starter_kit_get_aws_cli3.png" width="600"/> <br/>
</p><p>4.Run the following to activate the certificate: <br/>
</p>
<pre>
aws iot create-certificate-from-csr --certificate-signing-request file://cert.csr --set-as-active &gt; certOutput.txt
</pre>
<p>5.Run the following to save the certificate into a cert.pem file: <br/>
</p>
<pre>
aws iot describe-certificate --certificate-id &lt;certificate ID&gt; --output text --query certificateDescription.certificatePem  &gt; cert.pem
</pre>
<p><img src="img/AWS_Edison_starter_kit_get_aws_cli4.png" width="560"/> <br/>
NOTE: Replace &lt;certificate ID&gt; with the ID stored in the "certificateId" field in certOutput.txt. To view the file enter: more certOutput.txt <br/>
</p><p>6.Create a Json policy document for AWS IoT SDK: <br/>
</p>
<ul><li> Copy the following text (ctrl-c):
</li></ul>
<pre>
{
"Version": "2012-10-17",
"Statement": [{
"Effect": "Allow",
"Action":["iot:*"],
"Resource": ["*"]
}]
}
</pre>
<ul><li> Enter vi policy.doc hit a and right click to paste the text <br/>
</li><li> Hit escape and type in :wq to save and quit <br/>
</li></ul>
<p><img src="img/AWS_Edison_starter_kit_get_aws_cli5.png" width="555"/> <br/>
</p><p>7.First enter: <br/>
</p>
<pre>
 aws iot create-policy --policy-name PubSubToAnyTopic --policy-document file://policy.doc
</pre>
<p>Notice:The policy name can be anything. <br/>
</p><p><img src="img/AWS_Edison_starter_kit_get_aws_cli6.png" width="562"/> <br/>
</p><p>8.After that a policy and a certificate can be shown on your AWS console. <br/> <br/>
<img src="img/AWS_Edison_starter_kit_get_aws_cli7.png" width="600"/> <br/>
</p><p>9.Then attach the policy to the certificate with: <br/>
</p>
<pre>
aws iot attach-principal-policy --principal &lt;principal arn&gt; --policy-name "PubSubToAnyTopic"
</pre>
<p>NOTE: replace &lt;principal arn&gt; with the  value stored in "certifcateArn" in the outputCert.txt file. <br/> <br/>
<img src="img/AWS_Edison_starter_kit_get_aws_cli8.png" width="564"/> <br/>
</p><p>10.You should see your certificate has attach to your policy. <br/> <br/>
<img src="img/AWS_Edison_starter_kit_get_aws_cli9.png" width="600"/> <br/>
</p><p><b>Use MQTT to subscribe and publish to AWS</b> <br/>
</p>
<ul><li> Now that the certificates are in order we can use MQTT to subscribe and publish to the cloud. <br/>
</li><li> First get the root CA pem file: <br/>
</li></ul>
<pre>
curl https://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem &gt; rootCA.pem
</pre>
<p><img src="img/AWS_Edison_starter_kit_get_aws_cli10.png" width="554"/> <br/>
</p>
<h3>  Coding your application with nodejs </h3>
<p>1.Create a nodejs project <br/>
</p>
<pre>
cd ~
mkdir aws_nodejs &amp;&amp; cd aws_nodejs
npm init
npm install --save aws-iot-device-sdk
touch main.js
</pre>
<p><img src="img/AWS_Edison_starter_kit_coding1.png" width="513"/> <br/>
</p><p>2.Copy and save demo code to main.js <br/>
</p>
<pre>
vi main.js
</pre>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="javascript source-javascript"><pre class="de1"><span class="co1">// Plug Grove - Relay to base shield port D2</span>
<span class="co1">// Plug Grove - Temperature&amp;Huminity(High quality) to i2c port</span>
 
<span class="kw1">var</span> sensor1 <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'jsupm_th02'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> th02 <span class="sy0">=</span> <span class="kw1">new</span> sensor1.<span class="me1">TH02</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="kw1">var</span> sensor2 <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'jsupm_grove'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> relay <span class="sy0">=</span> <span class="kw1">new</span> sensor2.<span class="me1">GroveRelay</span><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// Simulate device value</span>
<span class="kw1">var</span> temp <span class="sy0">=</span> <span class="nu0">24.00</span><span class="sy0">;</span>
<span class="kw1">var</span> humi <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span>
<span class="kw1">var</span> relayState <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>
<span class="kw1">var</span> reported_state <span class="sy0">=</span> <span class="br0">{</span><span class="st0">"Temperature"</span><span class="sy0">:</span>temp<span class="sy0">,</span> <span class="st0">"Humidity"</span><span class="sy0">:</span> humi<span class="sy0">,</span> <span class="st0">"RelayState"</span><span class="sy0">:</span> relayState<span class="br0">}</span><span class="sy0">;</span>
 
<span class="co1">//</span>
<span class="co1">// Client token value returned from thingShadows.update() operation//app deps</span>
<span class="kw1">const</span> thingShadow <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'./node_modules/aws-iot-device-sdk/thing'</span><span class="br0">)</span><span class="sy0">;</span><span class="co1">// Plug Grove - Relay to base shield port D2</span>
<span class="co1">// Plug Grove - Temperature&amp;Huminity(High quality) to i2c port</span>
 
<span class="kw1">var</span> sensor1 <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'jsupm_th02'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> th02 <span class="sy0">=</span> <span class="kw1">new</span> sensor1.<span class="me1">TH02</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="kw1">var</span> sensor2 <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'jsupm_grove'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> relay <span class="sy0">=</span> <span class="kw1">new</span> sensor2.<span class="me1">GroveRelay</span><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="kw1">var</span> awsIot <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'aws-iot-device-sdk'</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="kw1">var</span> thingShadows <span class="sy0">=</span> awsIot.<span class="me1">thingShadow</span><span class="br0">(</span><span class="br0">{</span>
    keyPath<span class="sy0">:</span> <span class="st0">'/home/root/aws_certs/privateKey.pem'</span><span class="sy0">,</span>
    certPath<span class="sy0">:</span> <span class="st0">'/home/root/aws_certs/cert.pem'</span><span class="sy0">,</span>
    caPath<span class="sy0">:</span> <span class="st0">'/home/root/aws_certs/rootCA.pem'</span><span class="sy0">,</span>
    clientId<span class="sy0">:</span> <span class="st0">'myAwsClientId'</span><span class="sy0">,</span>
    region<span class="sy0">:</span> <span class="st0">'us-east-1'</span>
<span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="co1">// Simulate device value</span>
<span class="kw1">var</span> temp <span class="sy0">=</span> <span class="nu0">24.00</span><span class="sy0">;</span>
<span class="kw1">var</span> humi <span class="sy0">=</span> <span class="nu0">50</span><span class="sy0">;</span>
<span class="kw1">var</span> relayState <span class="sy0">=</span> <span class="kw2">false</span><span class="sy0">;</span>
 
<span class="co1">//</span>
<span class="co1">// Client token value returned from thingShadows.update() operation</span>
<span class="co1">//</span>
<span class="kw1">var</span> clientTokenUpdate<span class="sy0">;</span>
 
<span class="kw1">var</span> thingName <span class="sy0">=</span> <span class="st0">"EdisonDemo"</span><span class="sy0">;</span>
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'connect'</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
    thingShadows.<span class="me1">register</span><span class="br0">(</span>thingName<span class="br0">)</span><span class="sy0">;</span>
    console.<span class="me1">log</span><span class="br0">(</span>thingName <span class="sy0">+</span> <span class="st0">' registering...'</span><span class="br0">)</span><span class="sy0">;</span>
 
    setInterval<span class="br0">(</span><span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
      readSensor<span class="br0">(</span>sendData<span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span><span class="sy0">,</span> <span class="nu0">5000</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'status'</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span>thingName<span class="sy0">,</span> stat<span class="sy0">,</span> clientToken<span class="sy0">,</span> stateObject<span class="br0">)</span> <span class="br0">{</span>
    console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'   received '</span><span class="sy0">+</span>stat<span class="sy0">+</span><span class="st0">' on '</span><span class="sy0">+</span>thingName<span class="sy0">+</span><span class="st0">': '</span><span class="sy0">+</span> JSON.<span class="me1">stringify</span><span class="br0">(</span>stateObject<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">//</span>
    <span class="co1">// These events report the status of update(), get(), and delete()</span>
    <span class="co1">// calls.  The clientToken value associated with the event will have</span>
    <span class="co1">// the same value which was returned in an earlier call to get(),</span>
    <span class="co1">// update(), or delete().  Use status events to keep track of the</span>
    <span class="co1">// status of shadow operations.</span>
    <span class="co1">//</span>
<span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'delta'</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span>thingName<span class="sy0">,</span> stateObject<span class="br0">)</span> <span class="br0">{</span>
    console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'    received delta on '</span><span class="sy0">+</span>thingName<span class="sy0">+</span><span class="st0">': '</span><span class="sy0">+</span> JSON.<span class="me1">stringify</span><span class="br0">(</span>stateObject<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
 
    <span class="kw1">if</span><span class="br0">(</span>stateObject.<span class="me1">state</span>.<span class="me1">RelayState</span> <span class="sy0">==</span> <span class="kw2">true</span><span class="br0">)</span><span class="br0">{</span>
        relay.<span class="me1">on</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'Relay is on.'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
    <span class="kw1">else</span> <span class="kw1">if</span><span class="br0">(</span>stateObject.<span class="me1">state</span>.<span class="me1">RelayState</span> <span class="sy0">==</span> <span class="kw2">false</span><span class="br0">)</span> <span class="br0">{</span>
        relay.<span class="me1">off</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
        console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'Relay is off.'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'timeout'</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span>thingName<span class="sy0">,</span> clientToken<span class="br0">)</span> <span class="br0">{</span>
    console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'    received timeout on '</span><span class="sy0">+</span>thingName <span class="sy0">+</span> <span class="st0">' with token: '</span><span class="sy0">+</span> clientToken<span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">//</span>
    <span class="co1">// In the event that a shadow operation times out, you'll receive</span>
    <span class="co1">// one of these events.  The clientToken value associated with the</span>
    <span class="co1">// event will have the same value which was returned in an earlier</span>
    <span class="co1">// call to get(), update(), or delete().</span>
    <span class="co1">//</span>
<span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="kw1">function</span> readSensor<span class="br0">(</span>callback<span class="br0">)</span><span class="br0">{</span>
    temp <span class="sy0">=</span> th02.<span class="me1">getTemperature</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    humi <span class="sy0">=</span> th02.<span class="me1">getHumidity</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    relayState <span class="sy0">=</span> relay.<span class="me1">isOn</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
 
    callback<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span><span class="sy0">;</span>
 
<span class="kw1">function</span> sendData<span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
    <span class="kw1">var</span> reported_state <span class="sy0">=</span> <span class="br0">{</span><span class="st0">"Temperature"</span><span class="sy0">:</span>temp<span class="sy0">,</span> <span class="st0">"Humidity"</span><span class="sy0">:</span> humi<span class="sy0">,</span> <span class="st0">"RelayState"</span><span class="sy0">:</span> relayState<span class="br0">}</span><span class="sy0">;</span>    
    <span class="kw1">var</span> relayTH02State <span class="sy0">=</span> <span class="br0">{</span><span class="st0">"state"</span><span class="sy0">:</span><span class="br0">{</span>desired<span class="sy0">:</span> reported_state<span class="br0">}</span><span class="br0">}</span><span class="sy0">;</span>  <span class="co1">// Use desired attribute can receive delta</span>
    <span class="co1">// More info refer to http://docs.aws.amazon.com/iot/latest/developerguide/thing-shadow-mqtt.html#update-pub-sub-message</span>
 
    clientTokenUpdate <span class="sy0">=</span> thingShadows.<span class="me1">update</span><span class="br0">(</span>thingName<span class="sy0">,</span> relayTH02State<span class="br0">)</span><span class="sy0">;</span>
 
    <span class="kw1">if</span> <span class="br0">(</span>clientTokenUpdate <span class="sy0">===</span> <span class="kw2">null</span><span class="br0">)</span>
    <span class="br0">{</span>
       console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'update shadow failed, operation still in progress'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span>
<span class="br0">}</span><span class="sy0">;</span></pre></div></div>
<p><br/>
3.start nodejs application
</p>
<ul><li> Plug Grove sensors just like below
</li><li> Relay - D2
</li><li> Temperature sensor - i2c port 
</li></ul>
<p><br/>
<img src="img/AWS_Edison_starter_kit_coding5.png" width="600"/> <br/>
</p>
<pre>
  node main.js
</pre>
<p><img src="img/AWS_Edison_starter_kit_coding2.png" width="568"/> <br/>
</p><p>4.Watch data on AWS console <br/> <br/>
<img src="img/AWS_Edison_starter_kit_coding3.png" width="431"/> <br/>
</p><p>5.Update shadow to change relay state <br/> <br/>
<img src="img/AWS_Edison_starter_kit_coding4.png" width="441"/> <br/>
</p><p>6.If uploading succeed Grove - Relay will turn on. <br/>
</p><p><br/>
<br/>
</p>
<h2> Resources</h2>
<ul><li> <a href="https://github.com/intel-iot-devkit/aws-iot-intel">aws-iot-intel github page</a>
</li><li> <a href="https://github.com/aws/aws-iot-device-sdk-js">aws-iot-device-sdk-js github page</a>
</li><li> <a href="https://github.com/intel-iot-devkit/upm">Intel UPM github page</a>
</li><li> <a href="https://github.com/intel-iot-devkit/aws-iot-intel">AWS IoT Intel Github Page</a>
</li><li> <a href="http://docs.aws.amazon.com/iot/latest/developerguide/thing-shadow-mqtt.html#update-pub-sub-message">AWS IoT MQTT update topic formate</a>
</li><li> <a href="res/AWS_IoT_Developer_Guide.pdf">【PDF】AWS IoT Developer Guide</a>
</li><li> <a href="/Grove_IoT_Starter_Kits_Powered_by_AWS">【Wiki】Main Page for Grove IoT Starter Kits Powered by AWS</a>
</li><li> <a href="https://software.intel.com/en-us/iot/library/edison-getting-started">Getting started with Edison</a>
</li></ul>
<p><br/>
</p>
<h2> Help us to make it better </h2>
<p><iframe frameborder="0" height="500" src="https://www.surveymonkey.com/r/DHCHL7G" width="500"></iframe>
</p>
Copyright (c) 2008-2016 Seeed Development Limited (<a href="http://www.seeedstudio.com">www.seeedstudio.com</a> / <a href="http://www.seeed.cc">www.seeed.cc</a>)<h6>This static html page was created from http://www.seeedstudio.com/wiki</h6></div></body></html>