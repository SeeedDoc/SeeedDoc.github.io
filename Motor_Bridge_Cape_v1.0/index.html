<html><head><meta name="viewport" content="width=device-width, initial-scale=1"><link href=//fonts.googleapis.com/css?family=Raleway:400,300,600 rel=stylesheet type=text/css><link rel="stylesheet" type="text/css" href="../common/css/normalize.css"><link rel="stylesheet" type="text/css" href="../common/css/skeleton.css"><link rel="stylesheet" type="text/css" href="../common/css/wiki.css"><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><title>Motor Bridge Cape v1.0</title><meta charset="utf-8"/><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-84386732-1', 'auto');
  ga('send', 'pageview');
</script>
</head>
<body><div class"container"><a href="../"><img src="../common/logo.png"/></a></div><div class="mw-content-ltr container" dir="ltr" id="mw-content-text" lang="en"><h1>Motor Bridge Cape v1.0</h1><div class="thumb tright"><div class="thumbinner" style="width:502px;"><img src="img/Motor_bridge_driver.jpg" width="500"/> <div class="thumbcaption"></div></div></div>
<p>The Motor Bridge Cape features bi-directional motor control using two TB6612FNG integrated dual H-bridge, so it can control two stepper motors or four brushed DC motors with 6 ~15V DC power and about 1A current draw per motor. The cape provides 5V regulated power to BBG or BBB with a max input voltage of 15V. It also has six servo control interfaces and six expand I\O. 
All the features are provided by the on board STM32F0 coprocessor. The MCU can communicate with BeagleBone by I<sup>2</sup>C or UART interface. 
</p><p><br/>
<a href="http://www.seeedstudio.com/depot/"><img src="../common/Get_One_Now_Banner.png" width="300"/></a>
</p><p><br/>
</p>
<p><br/>
<br/>
</p>
<h2> Features</h2>
<ul><li> Can drive 4 DC Motors or 2 Stepper Motors
</li><li> Can drive 6 Servos
</li><li> Mbed Platform
</li><li> STM32F0 coprocessor
</li><li> Two TB6612FNG
</li><li> 6 expand I\Os
</li><li> Communicate with BBG by I<sup>2</sup>C or UART interface
</li></ul>
<p><br/>
</p>
<h2> Specification</h2>
<ul><li> Battery Input Voltage: 6~15V
</li><li> H-bridge Working Voltage: 6~15V
</li><li> DC/DC 5V output current: 2A max
</li><li> 3V3 output current: 350mA max
</li><li> 4 H-bridge driver,each rated current:1.2A, peak current:3.2A
</li><li> 6 Servo driver, working voltage: 5V, total current is not more than 1.5A
</li><li> Input reverse connect protection
</li><li> Over current protection: 3A one-off quick fuse
</li></ul>
<p><br/>
</p>
<h2> Hardware Overview</h2>
<p><img src="img/Motor_Bridge_Hardware_overview.jpg" width="800"/>
</p>
<ul><li> <b>3A one time Fuse</b>: Over-current protection
</li><li> <b>Reset Button</b>: Reset the coprocessor
</li><li> <b>SWD Interface</b>: Debug interface
</li><li> <b>Prototype board</b>: Extend other circuits
</li><li> <b>GPIOs</b>: Extend other circuits
</li><li> <b>Servos</b>: Servo motor interface
</li><li> <b>STM32F030R8</b>: The coprocessor
</li><li> <b>DC/DC</b>: Voltage conversion circuit
</li><li> <b>TB6612FNG</b>: H-bridge IC
</li><li> <b>Indicator</b>: Indicating lamp for motor direction
</li><li> <b>Working Mode Switch</b>: Standby or Working
</li><li> <b>Input Reverse Protection</b>: Protect circuit
</li><li> <b>Motor4/Motor3</b>: Drive 2 DC motors or 1 Stepper motor
</li><li> <b>Motor2/Motor1</b>: Drive 2 DC motors or 1 Stepper motor
</li><li> <b>Battery</b>: Supply power for motor
</li></ul>
<p><br/>
<br/>
</p>
<h2> Getting Started</h2>
<p>After this section, I will show you how to use the Motor Bridge Cape on BBG. Before you get started, please download the Motor Bridge Cape Driver library code from the <a href="https://github.com/Seeed-Studio/MotorBridgeCapeforBBG_BBB">Github</a>.
</p><p>To use the Motor Bridge Cape Library simply add the MotorBridge.py file to your project. And import the python file to your project, and create a object of the Motor Bridge Cape. 
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="python source-python"><pre class="de1"><span class="kw1">import</span> MotorBridge
motor <span class="sy0">=</span> MotorBridge.<span class="me1">MotorBridgeCape</span><span class="br0">(</span><span class="br0">)</span></pre></div></div>
<h3> Stepper Motor</h3>
<p>The Stepper Motor Interface of Motor Bridge Cape just as the picture below shows.
</p><p><img src="img/StepperMotor.jpg" width="800"/>
</p>
<h4> The functions of Stepper Motor</h4>
<p>Here is the brief description about the function of stepper motor.
</p><p><u> <b>StepperMotorAInit()</b></u>
</p>
<dl><dd><i>Description</i> :  Init the Stepper Motor A port
</dd></dl>
<p><u> <b>StepperMotorAMove(MoveSteps,StepDelayTime)</b> </u>
</p>
<dl><dd><i>Description</i> :  Drive the Stepper Motor A.  
</dd><dd><i>MoveSteps</i> : How many steps the stepper motor will move. <b>Positive</b> stands for clock wise direction. <b>Negative</b> stands for counter-clock wise direction.
</dd><dd><i>StepDelayTime</i> :  The dead time for every step. unit: us.  
</dd></dl>
<p><u> <b>StepperMotorBInit()</b></u>
</p>
<dl><dd><i>Description</i> :  Init the Stepper Motor B port
</dd></dl>
<p><u> <b>StepperMotorBMove(MoveSteps,StepDelayTime)</b> </u>
</p>
<dl><dd><i>Description</i>:  Drive the Stepper Motor B.  
</dd><dd><i>MoveSteps</i>: How many steps the stepper motor will move. <b>Positive</b> stands for clock wise direction. <b>Negative</b> stands for counter-clock wise direction.
</dd><dd><i>StepDelayTime</i>:  The dead time for every step. unit: us.
</dd></dl>
<h4> Example of Stepper Motor</h4>
<p>Copy the following code to your project and save it as a python file. 
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="python source-python"><pre class="de1"><span class="kw1">import</span> MotorBridge
<span class="kw1">import</span> <span class="kw3">time</span>
 
<span class="kw1">def</span> StepperMotorATest<span class="br0">(</span><span class="br0">)</span>:
    <span class="kw1">print</span> <span class="st0">'Hello From MotorBridge'</span>
    motor.<span class="me1">StepperMotorAInit</span><span class="br0">(</span><span class="br0">)</span>
    motor.<span class="me1">StepperMotorAMove</span><span class="br0">(</span><span class="nu0">1000</span><span class="sy0">,</span><span class="nu0">1000</span><span class="br0">)</span> <span class="co1"># 1000 steppers  1000us every step</span>
    <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>
    motor.<span class="me1">StepperMotorAMove</span><span class="br0">(</span>-<span class="nu0">1000</span><span class="sy0">,</span><span class="nu0">1000</span><span class="br0">)</span> <span class="co1">#1000 steppers  1000us every step</span>
    <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>
 
<span class="kw1">def</span> StepperMotorBTest<span class="br0">(</span><span class="br0">)</span>:
    <span class="kw1">print</span> <span class="st0">'Hello From MotorBridge'</span>
    motor.<span class="me1">StepperMotorBInit</span><span class="br0">(</span><span class="br0">)</span>
    motor.<span class="me1">StepperMotorBMove</span><span class="br0">(</span><span class="nu0">1000</span><span class="sy0">,</span><span class="nu0">1000</span><span class="br0">)</span> <span class="co1"># 1000steppers  1000us every step</span>
    <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>
    motor.<span class="me1">StepperMotorBMove</span><span class="br0">(</span>-<span class="nu0">1000</span><span class="sy0">,</span><span class="nu0">1000</span><span class="br0">)</span> <span class="co1"># 1000 steppers  1000us every step</span>
    <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span>
 
 
<span class="kw1">if</span> __name__<span class="sy0">==</span><span class="st0">"__main__"</span>:
    motor <span class="sy0">=</span> MotorBridge.<span class="me1">MotorBridgeCape</span><span class="br0">(</span><span class="br0">)</span>
    StepperMotorATest<span class="br0">(</span><span class="br0">)</span>
    StepperMotorBTest<span class="br0">(</span><span class="br0">)</span></pre></div></div>
<h3> DC Motor</h3>
<p>The DC Motor Interface of Motor Bridge Cape just as the picture below shows.
</p><p><img src="img/DCMotorBBG.jpg" width="800"/>
</p>
<h4> The functions of DC Motor</h4>
<p>Here is the brief description about the functions of DC motor.
</p><p><u> <b>DCMotorInit(MotorName,Frequency)</b></u>
</p>
<dl><dd><i>Description</i>:  Init the DC Motor ant set the frequency 
</dd><dd><i>MotorName</i>: 1 ~ 4 stands for Motor1 ~ Motor4.
</dd><dd><i>Frequency</i>:  Set the frequency of the DC motor.  
</dd></dl>
<p><b>Note:</b>If you change the DC motor frequency, the other DC Motors's frequency will change too.
</p><p><u> <b>DCMotorMove(MotorName,Direction,PWMDuty)</b> </u>
</p>
<dl><dd><i>Description</i>:  Drive the DC Motor. Set the direction and PWMDuty.
</dd><dd><i>MotorName</i>: 1 ~ 4 stands for Motor1 ~ Motor4.
</dd><dd><i>Direction</i>: 1 stands for clock wise. 2 stands for counter-clock wise. 3 Stop the motor.  
</dd><dd><i>PWMDuty</i>: 0 ~ 100 stands for 0%~ 100% of the pwm duty.
</dd></dl>
<p><u> <b>motor.DCMotorStop(MotorName)</b> </u>
</p>
<dl><dd><i>Description</i>:  Stop the DC Motor.
</dd><dd><i>MotorName</i>: 1 ~ 4 stands for Motor1 ~ Motor4.
</dd></dl>
<h4> Example of DC Motor</h4>
<p>Copy the following code to your project and save it as a python file. 
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="python source-python"><pre class="de1"><span class="kw1">import</span> MotorBridge
<span class="kw1">import</span> <span class="kw3">time</span>
 
MotorName        <span class="sy0">=</span> <span class="nu0">1</span>
ClockWise        <span class="sy0">=</span> <span class="nu0">1</span>
CounterClockWise <span class="sy0">=</span> <span class="nu0">2</span>
PwmDuty          <span class="sy0">=</span> <span class="nu0">90</span>
Frequency        <span class="sy0">=</span> <span class="nu0">1000</span>
 
<span class="kw1">if</span> __name__<span class="sy0">==</span><span class="st0">"__main__"</span>:
    motor <span class="sy0">=</span> MotorBridge.<span class="me1">MotorBridgeCape</span><span class="br0">(</span><span class="br0">)</span>
    motor.<span class="me1">DCMotorInit</span><span class="br0">(</span>MotorName<span class="sy0">,</span>Frequency<span class="br0">)</span>
    <span class="kw1">while</span> <span class="kw2">True</span>:
        motor.<span class="me1">DCMotorMove</span><span class="br0">(</span>MotorName<span class="sy0">,</span>ClockWise<span class="sy0">,</span>PwmDuty<span class="br0">)</span>
        <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span>
        motor.<span class="me1">DCMotorMove</span><span class="br0">(</span>MotorName<span class="sy0">,</span>CounterClockWise<span class="sy0">,</span>PwmDuty<span class="br0">)</span>
        <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span>
        <span class="kw1">print</span> <span class="st0">"hello"</span>
        motor.<span class="me1">DCMotorStop</span><span class="br0">(</span>MotorName<span class="br0">)</span>
        <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span></pre></div></div>
<h3> Servo</h3>
<p>The Servo Interface of Motor Bridge Cape just as the picture below shows.
</p><p><img src="img/ServoBBG.jpg" width="800"/>
</p>
<h4> The functions of Servo</h4>
<p>Here is the brief description about the functions of Servo.
</p><p><u> <b>ServoInit(ServoName,Frequency)</b></u>
</p>
<dl><dd><i>Description</i>:  Init the Servo and set the frequency 
</dd><dd><i>ServoName</i>: 1 ~ 6 stands for Servo1 ~ Servo6.
</dd><dd><i>Frequency</i>:  Set the frequency of the Servo, the default value is 50 Hz.  
</dd></dl>
<p><u> <b>ServoMoveAngle(ServoName,Angle)</b> </u>
</p>
<dl><dd><i>Description</i>:  Drive the Servo. Set the Servo angle.
</dd><dd><i>ServoName</i>: 1 ~ 6 stands for Servo1 ~ Servo6.
</dd><dd><i>Angle</i>: 0 ~ 180  stands for 0 degrees to 180 degrees.  
</dd></dl>
<p><br/>
</p>
<h4> Example of Servo</h4>
<p>Copy the following code to your project and save it as a python file. 
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="python source-python"><pre class="de1"><span class="kw1">import</span> MotorBridge
<span class="kw1">import</span> <span class="kw3">time</span>
ServoName   <span class="sy0">=</span>  <span class="nu0">2</span>
Frequency   <span class="sy0">=</span>  <span class="nu0">50</span>
Angle1      <span class="sy0">=</span>  <span class="nu0">20</span>
Angle2      <span class="sy0">=</span>  <span class="nu0">160</span>
 
<span class="kw1">if</span> __name__<span class="sy0">==</span><span class="st0">"__main__"</span>:
    motor <span class="sy0">=</span> MotorBridge.<span class="me1">MotorBridgeCape</span><span class="br0">(</span><span class="br0">)</span>
    motor.<span class="me1">ServoInit</span><span class="br0">(</span>ServoName<span class="sy0">,</span>Frequency<span class="br0">)</span>
 
    <span class="kw1">while</span> <span class="kw2">True</span>:
        <span class="kw1">print</span> <span class="st0">'Servo Test'</span>
        motor.<span class="me1">ServoMoveAngle</span><span class="br0">(</span>ServoName<span class="sy0">,</span>Angle1<span class="br0">)</span>
        <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span>
        motor.<span class="me1">ServoMoveAngle</span><span class="br0">(</span>ServoName<span class="sy0">,</span>Angle2<span class="br0">)</span>
        <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span></pre></div></div>
<h2> Upgrade the Firmware</h2>
<p>If there's something wrong with your cape, try to upgrade it. In this section, I will show you how to upgrade the Motor Bridge Cape Firmware using BeagleBone Green, it also works on BBGW and BBB.
</p><p>1. Insert the Motor Bridge Cape to BBG/BBGW/BBB, and  connect BBG to your computer via USB cable.
</p><p>2. Let your BBG connect to the internet, and access it via SSH as the picture below shows.
</p><p><img src="img/BBG1.PNG" width="600"/>
</p><p>3. Download the code from Github by execute following commands
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1">git clone https<span class="sy4">:</span><span class="co1">//github.com/Seeed-Studio/MotorBridgeCapeFirmware</span></pre></div></div>
<p><img src="img/BBG2.PNG" width="600"/>
</p><p>4. Navigate to "MotorBridgeCapeFirmware" and execute "make flash" command to flash the firmware.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1">cd MotorBridgeCapeFirmware<span class="sy2">/</span> <span class="sy3">&amp;&amp;</span> make flash</pre></div></div>
<p>After a few seconds, you can see "Verification OK" information from the terminal
</p><p>5. Check if the firmware is flash well by execute following command 
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1">i2cdetect <span class="sy2">-</span>y <span class="sy2">-</span>r <span class="nu0">1</span></pre></div></div>
<p><img src="img/BBG3.PNG" width="562"/>
</p><p>If you find the I2C address 0x4b,it means you have already refreshed the firmware successfully.
</p>
<h3>  Known issues </h3>
<h4>  Can't find the I2C address </h4>
<p>Q: I have already update the firmware, but can't detect the i2c address?
</p><p>A：Be sure that the P9_23 Pin is High, since the P9_23 is connect to Reset pin of STM32, I set the P9_23 pin to high level in the initialization function of MotorBridgeCape class.
</p>
<h4>  Can't Update the firmware </h4>
<p>Q: When I update the firmware, the error information says that can't find the UART2?
</p><p>A: You should enable the BB-UART2, since the BBG flash the firmware to Motor Bridge Cape by UART2..
</p>
<pre>vi /boot/uEnv.txt
</pre>
<p>Then uncomment "cape_enable=capemgr.enable_partno=BB-UART2". Save and exit the editor, at last reboot your board. 
</p>
<h4>  The Cape still can't working </h4>
<p>Q: I have already update the firmware successfully and can detect the I2C address, but why I still can't get the cape working?
</p><p>A: Please mention that there's a working mode switch on the board, be sure the switch is turn to working. If you still have other questions, please come to our forum.
</p>
<h2> Resources</h2>
<ul><li> <a href="res/Motor_Bridge_Cape_v1.0_sch.pdf">Schematic in PDF</a>
</li><li> <a href="res/Motor_Bridge_Cape_v1.0brd.rar">PCB in Eagle File</a>
</li><li> <a href="res/Motor_Bridge_Cape_v1.0sch.rar">Schematic in Eagle File</a>
</li><li> <a href="https://github.com/Seeed-Studio/MotorBridgeCapeforBBG_BBB">Motor Bridge Cape Library</a>
</li><li> <a href="https://github.com/Lee-Kevin/MotorBridgeCapeFirmwareSourceCode">Motor Bridge Cape Firmware Source Code</a>
</li></ul>
Copyright (c) 2008-2016 Seeed Development Limited (<a href="http://www.seeedstudio.com">www.seeedstudio.com</a> / <a href="http://www.seeed.cc">www.seeed.cc</a>)<h6>This static html page was created from http://www.seeedstudio.com/wiki</h6></div></body></html>