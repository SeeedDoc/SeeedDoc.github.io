<html><head><meta name="viewport" content="width=device-width, initial-scale=1"><link href=//fonts.googleapis.com/css?family=Raleway:400,300,600 rel=stylesheet type=text/css><link rel="stylesheet" type="text/css" href="../common/css/normalize.css"><link rel="stylesheet" type="text/css" href="../common/css/skeleton.css"><link rel="stylesheet" type="text/css" href="../common/css/wiki.css"><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><title>Beagle Bone Green and Grove IoT Starter Kit Powered by AWS</title><meta charset="utf-8"/></head><body><div class"container"><a href="../index.html"><img src="../common/logo.png"/></a></div><div class="mw-content-ltr container" dir="ltr" id="mw-content-text" lang="en"><h1>Beagle Bone Green and Grove IoT Starter Kit Powered by AWS</h1><div class="thumb tright"><div class="thumbinner" style="width:502px;"><img src="img/Aws_kit_bbg_cover.JPG" width="500"/> <div class="thumbcaption"></div></div></div>
<p><i>Main articles: Start here <a href="/Grove_IoT_Starter_Kits_Powered_by_AWS" title="Grove IoT Starter Kits Powered by AWS">Grove IoT Starter Kits Powered by AWS</a> , <a href="/Beaglebone_green" title="Beaglebone green"> Beaglebone Green</a></i>
</p><p><a href="http://www.seeedstudio.com/depot/BeagleBone-Green-p-2504.html?cPath=122_113">BeagleBone Green</a> (BBG) is a joint effort by BeagleBoard.org and Seeed Studio. It is based on the open-source hardware design of <a href="http://beagleboard.org/BLACK">BeagleBone Black</a> and has added two Grove connectors. The kit contains the new BBG, 10 Grove modules as well as step-by-step tutorials to hook them up quickly. The Grove IoT Starter Kit includes most frequently used sensors and actuators to turn your ideas into tangible applications with AWS Cloud computing. 
</p><p><br/>
<a href="http://www.amazon.com/dp/B0168L6B0C"><img src="../common/Get_One_Now_Banner.png" width="300"/></a>
</p><p><br/>
</p>
<p><br/>
</p>
<h2> Features </h2>
<ul><li> Out-of-box, plug and play, no breadboard or soldering
</li><li> Fully compliant with AWS Services and AWS best practices
</li><li> Step-by-step tutorials for developers and makers to get started quickly
</li></ul>
<p><br/>
</p>
<h2> Included in the Box</h2>
<div class="thumb tright"><div class="thumbinner" style="width:502px;"><img src="img/Aws_kit_bbg.JPG" width="500"/> <div class="thumbcaption"></div></div></div>
<table>
<tr>
<th> Board/Part </th>
<th> Qty </th>
<th> Documentation
</th></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/BeagleBone-Green-p-2504.html?cPath=122_113">BeagleBone Green</a> </td>
<td> 1 </td>
<td> <a href="/Beaglebone_green" title="Beaglebone green"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-I2C-ADC-p-1580.html?cPath=98_16">Grove - I2C ADC</a> </td>
<td> 1 </td>
<td> <a href="/Grove-I2C_ADC" title="Grove - I2C ADC"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-I2C-Hub-p-851.html?cPath=98_16">Grove - I2C Hub</a></td>
<td> 1 </td>
<td> <a href="/Grove-I2C_Hub" title="Grove - I2C Hub"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Relay-p-769.html?cPath=39_42">Grove - Relay</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Relay" title="Grove - Relay"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Buzzer-p-768.html?cPath=38">Grove - Buzzer</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Buzzer" title="Grove - Buzzer"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-OLED-Display-096-p-824.html?cPath=34_36">Grove - OLED Display 0.96'</a>' </td>
<td> 1 </td>
<td> <a href="/Grove-OLED_Display_96x96" title="Grove - OLED Display 96*96"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Button-p-766.html?cPath=85_50">Grove - Button</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Button" title="Grove - Button"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Temperature-Sensor-p-774.html?cPath=25_125">Grove - Temperature Sensor</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Temperature_Sensor_V1.2" title="Grove - Temperature Sensor V1.2"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Sound-Sensor-p-752.html?cPath=25_128">Grove - Sound Sensor</a></td>
<td> 1 </td>
<td> <a href="/Grove-Sound_Sensor" title="Grove - Sound Sensor"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-3Axis-Digital-Accelerometer16g-p-1156.html?cPath=25_132">Grove - 3-Axis Digital Accelerometer(±16g)</a> </td>
<td> 1 </td>
<td> <a href="/Grove-3-Axis_Digital_Accelerometer-16g" title="Grove - 3-Axis Digital Accelerometer(±16g)"> Read Here</a>
</td></tr>
<tr>
<td><a href="http://www.seeedstudio.com/depot/Grove-Chainable-RGB-LED-p-850.html?cPath=81_35">Grove - Chainable RGB LED</a> </td>
<td> 1 </td>
<td> <a href="/Grove-Chainable_RGB_LED" title="Grove - Chainable RGB LED"> Read Here</a>
</td></tr>
<tr>
<td>Micro USB Cable - 48cm </td>
<td>1 </td>
<td>
</td></tr></table>
<h2> Getting Started </h2>
<h3> Configure Your AWS IoT Service</h3>
<p>At the very beginning, we need to get an AWS IoT service account, and do some configuring. 
</p>
<ul><li>Create an <a href="http://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/AMS5.0CreatingAnAWSAccount.html">AWS Account</a>
</li><li>Go to <a href="https://aws.amazon.com/iot/">AWS IoT Console</a> and open the AWS IoT Dashboard
</li></ul>
<dl><dd> 1. Click the <b>Services</b> on the top-left corner, and then click on AWS IoT, as shown at below image.
</dd><dd>
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_click_service.jpg" width="600"/>
</p>
<dl><dd>
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_click_iot.png" width="600"/>
</p>
<dl><dd> 2. Click <b>Get started</b> button.
</dd><dd>
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_click_get_started.jpg" width="600"/>
</p>
<dl><dd> 3. Click on <b>Create a Resource</b> and then click <b>Creat a thing</b>.
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_click_create_a_thing.jpg" width="600"/>
</p>
<dl><dd>
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_view_a_thing.jpg" width="600"/>
</p>
<dl><dd>
</dd></dl>
<p><img src="img/AWS_LinkIt_starter_kit_name_a_thing.png" width="600"/>
</p>
<dl><dd> 4. Enter a name, whatever you like, here we name it temperature.
</dd></dl>
<p><img src="img/BbgAWSCreateAThing.png" width="600"/>
</p>
<dl><dd> 5.Click <b>Create</b> to complete it and then click on <b>View thing</b> to get information of the thing you create. 
</dd></dl>
<p><img src="img/BbgAWSViewThing.png" width="600"/>
</p>
<dl><dd> 6. Click on <b>Connect a device</b>.
</dd></dl>
<p><img src="img/BbgAWSConnectADevice.png" width="449"/>
</p>
<dl><dd> 7. Choose Node JS and Click on <b>Generate certificate and policy</b>.
</dd></dl>
<p><img src="img/BbgAWSGenerate.png" width="600"/>
</p>
<dl><dd> 8. You will find 3 files. Download the file, we need them later. And click on <b>Confirm &amp; start connecting</b>.
</dd></dl>
<p><img src="img/BbgAWSConfirm.png" width="600"/>
</p>
<dl><dd> 9. Then we should download the AWS IoT Node.js SDK and click on <b>Return to Thing Detail</b>.
</dd></dl>
<p><img src="img/BbgAWSReturn.png" width="600"/>
</p><p>Now, this step is done. Let's move to the next step.
</p>
<h3> Setup your BeagleBone Green</h3>
<p>Connect BBG to your PC via micro USB cable, and let BBG access the Internet. If this is your first time to use BBG/BBB, maybe you can follow <a href="/Beaglebone_green">here</a> to get started.
</p><p>Connect Grove modules to BBG as the picture below shows.
</p><p><img src="img/BbgAWSSetup.jpg" width="600"/>
</p>
<h3> Software Works</h3>
<h4>  Upload SDK and keys file to Cloud9 examples folder </h4>
<dl><dd> 1.Do you still remember the 3 key files and Node JS SDK that you have already download before.
</dd></dl>
<p><img src="img/BbgAWSFile.png" width="600"/>
</p>
<dl><dd> 2.Now, upload the SDK and keys file to your Cloud9 examples folder.
</dd></dl>
<p><img src="img/BbgAWSUpload1.png" width="600"/>
</p><p><img src="img/BbgAWSUpload2.png" width="371"/>
</p>
<h4>  Open a new terminal </h4>
<p>We need unzip the SDK and move the keys to right place.
</p><p><img src="img/BbgAWSUNzip.png" width="600"/>
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2"># cd examples</span></pre></div></div>
<p>And unzip the SDK file.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2"># unzip aws-iot-device-sdk-js-latest.zip</span></pre></div></div>
<p>Then entering the unziped folder.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2">#cd aws-iot-device-sdk-js</span></pre></div></div>
<p>Install the dependent packages.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2"># npm install</span></pre></div></div>
<p><img src="img/BbgAWSMkdir.png" width="600"/>
</p><p>Create a new folder named awsCerts.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2"># mkdir awsCerts &amp;&amp; cd awsCerts</span></pre></div></div>
<p>And then move the 3 key files to the new folder.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2"># mv ../../31f2fd2680-* .</span></pre></div></div>
<p>Please note that 31f2fd2680 should be replaced by your own key files number.
</p><p>And rename the key files
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2"># mv 31f2fd2680-certificate.pem.crt.txt  certificate.pem.crt</span>
<span class="co2"># mv 31f2fd2680-private.pem.key   private.pem.key</span></pre></div></div>
<p>Download a file from the internet.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2"># wget https://www.symantec.com/content/en/us/enterprise/verisign/roots/VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem</span></pre></div></div>
<p>And rename the downloaded file as root-CA.crt.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="arduino source-arduino"><pre class="de1"><span class="co2">#mv VeriSign-Class%203-Public-Primary-Certification-Authority-G5.pem root-CA.crt</span></pre></div></div>
<p><img src="img/BbgAWSRename.png" width="600"/>
</p>
<h4>  Programming on BBG </h4>
<p>Enter the examples folder.
</p>
<pre>
# cd .. &amp;&amp; cd examples/
</pre>
<p><img src="img/BbgAWSexamples.png" width="600"/>
</p><p>Create a new file named grove_temperature_sensor.py.
</p>
<pre>
# vim grove_temperature_sensor.py
</pre>
<p>And copy the following code to the file.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="python source-python"><pre class="de1"><span class="co1">#!/usr/bin/python</span>
<span class="co1"># -*- coding: utf-8 -*-</span>
 
<span class="kw1">import</span> <span class="kw3">time</span>
<span class="kw1">import</span> <span class="kw3">math</span>
<span class="kw1">import</span> Adafruit_BBIO.<span class="me1">GPIO</span> <span class="kw1">as</span> GPIO
<span class="kw1">from</span> Adafruit_I2C <span class="kw1">import</span> Adafruit_I2C
BUZZER <span class="sy0">=</span> <span class="st0">"P9_22"</span>            <span class="co1"># GPIO P9_22</span>
GPIO.<span class="me1">setup</span><span class="br0">(</span>BUZZER<span class="sy0">,</span> GPIO.<span class="me1">OUT</span><span class="br0">)</span>
 
<span class="co1"># The threshold to turn the buzzer on 28 Celsius</span>
THRESHOLD_TEMPERATURE <span class="sy0">=</span> <span class="nu0">28</span>
ADDR_ADC121 <span class="sy0">=</span> <span class="nu0">0x50</span>
 
REG_ADDR_RESULT <span class="sy0">=</span> <span class="nu0">0x00</span>
REG_ADDR_ALERT <span class="sy0">=</span> <span class="nu0">0x01</span>
REG_ADDR_CONFIG <span class="sy0">=</span> <span class="nu0">0x02</span>
REG_ADDR_LIMITL <span class="sy0">=</span> <span class="nu0">0x03</span>
REG_ADDR_LIMITH <span class="sy0">=</span> <span class="nu0">0x04</span>
REG_ADDR_HYST <span class="sy0">=</span> <span class="nu0">0x05</span>
REG_ADDR_CONVL <span class="sy0">=</span> <span class="nu0">0x06</span>
REG_ADDR_CONVH <span class="sy0">=</span> <span class="nu0">0x07</span>
 
i2c <span class="sy0">=</span> Adafruit_I2C<span class="br0">(</span>ADDR_ADC121<span class="br0">)</span>           
 
<span class="kw1">class</span> I2cAdc:
    <span class="kw1">def</span> <span class="kw4">__init__</span><span class="br0">(</span><span class="kw2">self</span><span class="br0">)</span>:
        i2c.<span class="me1">write8</span><span class="br0">(</span>REG_ADDR_CONFIG<span class="sy0">,</span> <span class="nu0">0x20</span><span class="br0">)</span>
 
    <span class="kw1">def</span> read_adc<span class="br0">(</span><span class="kw2">self</span><span class="br0">)</span>:
        <span class="st0">"Read ADC data 0-4095."</span>
        data_list <span class="sy0">=</span> i2c.<span class="me1">readList</span><span class="br0">(</span>REG_ADDR_RESULT<span class="sy0">,</span> <span class="nu0">2</span><span class="br0">)</span>
        <span class="co1">#print 'data list', data_list</span>
        data <span class="sy0">=</span> <span class="br0">(</span><span class="br0">(</span>data_list<span class="br0">[</span><span class="nu0">0</span><span class="br0">]</span> &amp; <span class="nu0">0x0f</span><span class="br0">)</span> <span class="sy0">&lt;&lt;</span> <span class="nu0">8</span> | data_list<span class="br0">[</span><span class="nu0">1</span><span class="br0">]</span><span class="br0">)</span> &amp; <span class="nu0">0xfff</span>
        <span class="kw1">return</span> data
adc <span class="sy0">=</span> I2cAdc<span class="br0">(</span><span class="br0">)</span>
 
<span class="co1">#   The argument in the read_temperature() method defines which Grove board(Grove Temperature Sensor) version you have connected.</span>
<span class="co1">#   Defaults to 'v1.2'. eg.</span>
<span class="co1">#       temp = read_temperature('v1.0')          # B value = 3975</span>
<span class="co1">#       temp = read_temperature('v1.1')          # B value = 4250</span>
<span class="co1">#       temp = read_temperature('v1.2')          # B value = 4250</span>
<span class="kw1">def</span> read_temperature<span class="br0">(</span>model <span class="sy0">=</span> <span class="st0">'v1.2'</span><span class="br0">)</span>:
    <span class="st0">"Read temperature values in Celsius from Grove Temperature Sensor"</span>
    <span class="co1"># each of the sensor revisions use different thermistors, each with their own B value constant</span>
    <span class="kw1">if</span> model <span class="sy0">==</span> <span class="st0">'v1.2'</span>:
        bValue <span class="sy0">=</span> <span class="nu0">4250</span>  <span class="co1"># sensor v1.2 uses thermistor ??? (assuming NCP18WF104F03RC until SeeedStudio clarifies)</span>
    <span class="kw1">elif</span> model <span class="sy0">==</span> <span class="st0">'v1.1'</span>:
        bValue <span class="sy0">=</span> <span class="nu0">4250</span>  <span class="co1"># sensor v1.1 uses thermistor NCP18WF104F03RC</span>
    <span class="kw1">else</span>:
        bValue <span class="sy0">=</span> <span class="nu0">3975</span>  <span class="co1"># sensor v1.0 uses thermistor TTC3A103*39H</span>
 
    total_value <span class="sy0">=</span> <span class="nu0">0</span>
    <span class="kw1">for</span> index <span class="kw1">in</span> <span class="kw2">range</span><span class="br0">(</span><span class="nu0">20</span><span class="br0">)</span>:
        sensor_value <span class="sy0">=</span> adc.<span class="me1">read_adc</span><span class="br0">(</span><span class="br0">)</span>
        total_value +<span class="sy0">=</span> sensor_value
        <span class="kw3">time</span>.<span class="me1">sleep</span><span class="br0">(</span><span class="nu0">0.05</span><span class="br0">)</span>
    average_value <span class="sy0">=</span> <span class="kw2">float</span><span class="br0">(</span>total_value / <span class="nu0">20</span><span class="br0">)</span>
 
    <span class="co1"># Transform the ADC data into the data of Arduino platform.</span>
    sensor_value_tmp <span class="sy0">=</span> <span class="br0">(</span><span class="kw2">float</span><span class="br0">)</span><span class="br0">(</span>average_value / <span class="nu0">4095</span> * <span class="nu0">2.95</span> * <span class="nu0">2</span> / <span class="nu0">3.3</span> * <span class="nu0">1023</span><span class="br0">)</span>
    resistance <span class="sy0">=</span> <span class="br0">(</span><span class="kw2">float</span><span class="br0">)</span><span class="br0">(</span><span class="nu0">1023</span> - sensor_value_tmp<span class="br0">)</span> * <span class="nu0">10000</span> / sensor_value_tmp
    temperature <span class="sy0">=</span> <span class="kw2">round</span><span class="br0">(</span><span class="br0">(</span><span class="kw2">float</span><span class="br0">)</span><span class="br0">(</span><span class="nu0">1</span> / <span class="br0">(</span><span class="kw3">math</span>.<span class="me1">log</span><span class="br0">(</span>resistance / <span class="nu0">10000</span><span class="br0">)</span> / bValue + <span class="nu0">1</span> / <span class="nu0">298.15</span><span class="br0">)</span> - <span class="nu0">273.15</span><span class="br0">)</span><span class="sy0">,</span> <span class="nu0">2</span><span class="br0">)</span>
    <span class="kw1">return</span> temperature
 
<span class="co1"># Function: If the temperature sensor senses the temperature that is up to the threshold you set in the code, the buzzer is ringing for 1s.</span>
<span class="co1"># Hardware: Grove - I2C ADC, Grove - Temperature Sensor, Grove - Buzzer</span>
<span class="co1"># Note: Use P9_22(UART2_RXD) as GPIO.</span>
<span class="co1"># Connect the Grove Buzzer to UART Grove port of Beaglebone Green.</span>
<span class="co1"># Connect the Grove - I2C ADC to I2C Grove port of Beaglebone Green, and then connect the Grove - Temperature Sensor to Grove - I2C ADC.</span>
<span class="kw1">if</span> __name__ <span class="sy0">==</span> <span class="st0">'__main__'</span>:
 
    <span class="kw1">while</span> <span class="kw2">True</span>:
        <span class="kw1">try</span>:
            <span class="co1"># Read temperature values in Celsius from Grove Temperature Sensor</span>
            temperature <span class="sy0">=</span> read_temperature<span class="br0">(</span><span class="st0">'v1.2'</span><span class="br0">)</span>
 
            <span class="co1"># When the temperature reached predetermined value, buzzer is ringing.</span>
            <span class="kw1">if</span> temperature <span class="sy0">&gt;</span> THRESHOLD_TEMPERATURE:
                <span class="co1"># Send HIGH to switch on BUZZER</span>
                GPIO.<span class="me1">output</span><span class="br0">(</span>BUZZER<span class="sy0">,</span> GPIO.<span class="me1">HIGH</span><span class="br0">)</span>
            <span class="kw1">else</span>:
                <span class="co1"># Send LOW to switch off BUZZER</span>
                GPIO.<span class="me1">output</span><span class="br0">(</span>BUZZER<span class="sy0">,</span> GPIO.<span class="me1">LOW</span><span class="br0">)</span>
 
            <span class="kw1">print</span> <span class="st0">"temperature = "</span><span class="sy0">,</span> temperature
 
        <span class="kw1">except</span> <span class="kw2">KeyboardInterrupt</span>:
            GPIO.<span class="me1">output</span><span class="br0">(</span>BUZZER<span class="sy0">,</span> GPIO.<span class="me1">LOW</span><span class="br0">)</span>
            <span class="kw1">break</span>
 
        <span class="kw1">except</span> <span class="kw2">IOError</span>:
            <span class="kw1">print</span> <span class="st0">"Error"</span></pre></div></div>
<p>Create a new file named python_sensor.py.
</p>
<pre>
#vim  python_sensor.py
</pre>
<p>Copy the following code to the new file.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="python source-python"><pre class="de1"><span class="kw1">import</span> <span class="kw3">socket</span>
<span class="kw1">import</span> grove_temperature_sensor
<span class="kw1">if</span> __name__ <span class="sy0">==</span> <span class="st0">"__main__"</span>:
    client <span class="sy0">=</span> <span class="kw3">socket</span>.<span class="kw3">socket</span><span class="br0">(</span><span class="kw3">socket</span>.<span class="me1">AF_INET</span><span class="sy0">,</span> <span class="kw3">socket</span>.<span class="me1">SOCK_STREAM</span><span class="br0">)</span>
    client.<span class="me1">connect</span><span class="br0">(</span><span class="br0">(</span><span class="st0">'127.0.0.1'</span><span class="sy0">,</span> <span class="nu0">7000</span><span class="br0">)</span><span class="br0">)</span>
 
    <span class="kw1">while</span> <span class="kw2">True</span>:
        temperature <span class="sy0">=</span> grove_temperature_sensor.<span class="me1">read_temperature</span><span class="br0">(</span><span class="st0">'v1.2'</span><span class="br0">)</span>
	<span class="kw1">print</span> temperature
        client.<span class="me1">sendall</span><span class="br0">(</span><span class="kw2">str</span><span class="br0">(</span><span class="st0">'%.2f'</span>%temperature<span class="br0">)</span><span class="br0">)</span>
    data <span class="sy0">=</span> client.<span class="me1">recv</span><span class="br0">(</span><span class="nu0">1024</span><span class="br0">)</span>
    <span class="kw1">print</span> data
    client.<span class="me1">close</span><span class="br0">(</span><span class="br0">)</span>
 
    <span class="kw1">print</span> <span class="st0">'Received'</span><span class="sy0">,</span> <span class="kw3">repr</span><span class="br0">(</span>data<span class="br0">)</span></pre></div></div>
<p>Create a new file named rgbled.js.
</p>
<pre>
#vim rgbled.js
</pre>
<p>And copy the following code to the new file.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="javascript source-javascript"><pre class="de1"><span class="kw1">var</span> exec <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'child_process'</span><span class="br0">)</span>.<span class="me1">exec</span><span class="sy0">;</span> 
<span class="kw1">var</span> value <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
 
exports.<span class="me1">initpins</span> <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
	exec<span class="br0">(</span><span class="st0">"echo 3 &gt; /sys/class/gpio/export"</span><span class="sy0">,</span><span class="kw1">function</span><span class="br0">(</span>error<span class="sy0">,</span>stdout<span class="sy0">,</span>stderr<span class="br0">)</span><span class="br0">{</span>
		<span class="kw1">if</span><span class="br0">(</span>error<span class="br0">)</span> 
        		console.<span class="me1">info</span><span class="br0">(</span><span class="st0">'stderr : '</span><span class="sy0">+</span>stderr<span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
	exec<span class="br0">(</span><span class="st0">"echo out &gt; /sys/class/gpio/gpio3/direction"</span><span class="sy0">,</span><span class="kw1">function</span><span class="br0">(</span>error<span class="sy0">,</span>stdout<span class="sy0">,</span>stderr<span class="br0">)</span><span class="br0">{</span>
                <span class="kw1">if</span><span class="br0">(</span>error<span class="br0">)</span> 
                        console.<span class="me1">info</span><span class="br0">(</span><span class="st0">'stderr : '</span><span class="sy0">+</span>stderr<span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
	exec<span class="br0">(</span><span class="st0">"echo 2 &gt; /sys/class/gpio/export"</span><span class="sy0">,</span><span class="kw1">function</span><span class="br0">(</span>error<span class="sy0">,</span>stdout<span class="sy0">,</span>stderr<span class="br0">)</span><span class="br0">{</span>
                <span class="kw1">if</span><span class="br0">(</span>error<span class="br0">)</span> 
                        console.<span class="me1">info</span><span class="br0">(</span><span class="st0">'stderr : '</span><span class="sy0">+</span>stderr<span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
	exec<span class="br0">(</span><span class="st0">"echo out &gt; /sys/class/gpio/gpio2/direction"</span><span class="sy0">,</span><span class="kw1">function</span><span class="br0">(</span>error<span class="sy0">,</span>stdout<span class="sy0">,</span>stderr<span class="br0">)</span><span class="br0">{</span>
                <span class="kw1">if</span><span class="br0">(</span>error<span class="br0">)</span> 
                        console.<span class="me1">info</span><span class="br0">(</span><span class="st0">'stderr : '</span><span class="sy0">+</span>stderr<span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="br0">}</span>
digitalwrite <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span>pin<span class="sy0">,</span>state<span class="br0">)</span><span class="br0">{</span>
	exec<span class="br0">(</span><span class="st0">"echo "</span><span class="sy0">+</span>state.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">+</span><span class="st0">" &gt; /sys/class/gpio/gpio"</span><span class="sy0">+</span>pin.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">+</span><span class="st0">"/value"</span><span class="sy0">,</span>
		<span class="kw1">function</span><span class="br0">(</span>error<span class="sy0">,</span>stdout<span class="sy0">,</span>stderr<span class="br0">)</span><span class="br0">{</span>
                	<span class="kw1">if</span><span class="br0">(</span>error<span class="br0">)</span> 
                        	console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'stderr : '</span><span class="sy0">+</span>stderr<span class="br0">)</span><span class="sy0">;</span>
        <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
<span class="br0">}</span>
sleep <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span>sleepTime<span class="br0">)</span> <span class="br0">{</span>
    <span class="kw1">for</span><span class="br0">(</span><span class="kw1">var</span> start <span class="sy0">=</span> <span class="sy0">+</span><span class="kw1">new</span> <span class="kw4">Date</span><span class="sy0">;</span> <span class="sy0">+</span><span class="kw1">new</span> <span class="kw4">Date</span> <span class="sy0">-</span> start <span class="sy0">&lt;=</span> sleepTime<span class="sy0">;</span> <span class="br0">)</span> <span class="br0">{</span> <span class="br0">}</span>
<span class="br0">}</span>
clk <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
		digitalwrite<span class="br0">(</span><span class="nu0">2</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		sleep<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span>
                digitalwrite<span class="br0">(</span><span class="nu0">2</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
		sleep<span class="br0">(</span><span class="nu0">2</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
sendByte <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span>b<span class="br0">)</span><span class="br0">{</span>
	<span class="kw1">for</span><span class="br0">(</span><span class="kw1">var</span> i <span class="sy0">=</span> <span class="nu0">0</span> <span class="sy0">;</span> i <span class="sy0">&lt;</span> <span class="nu0">8</span> <span class="sy0">;</span>i<span class="sy0">++</span><span class="br0">)</span><span class="br0">{</span>
		<span class="kw1">if</span><span class="br0">(</span><span class="br0">(</span>b <span class="sy0">&amp;</span> 0x80<span class="br0">)</span> <span class="sy0">!=</span> <span class="nu0">0</span><span class="br0">)</span>
			digitalwrite<span class="br0">(</span><span class="nu0">3</span><span class="sy0">,</span><span class="nu0">1</span><span class="br0">)</span><span class="sy0">;</span>
		<span class="kw1">else</span>
			digitalwrite<span class="br0">(</span><span class="nu0">3</span><span class="sy0">,</span><span class="nu0">0</span><span class="br0">)</span><span class="sy0">;</span>
		clk<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
		b <span class="sy0">=</span> b <span class="sy0">&lt;&lt;</span> <span class="nu0">1</span><span class="sy0">;</span> 
	<span class="br0">}</span>
<span class="br0">}</span>
setColor <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span>red<span class="sy0">,</span>green<span class="sy0">,</span>blue<span class="br0">)</span><span class="br0">{</span>
	<span class="kw1">var</span> prefix <span class="sy0">=</span> 0xc0<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">(</span><span class="br0">(</span>blue <span class="sy0">&amp;</span> 0x80<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span>
		prefix <span class="sy0">|=</span> 0x20<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">(</span><span class="br0">(</span>blue <span class="sy0">&amp;</span> 0x40<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span>
		prefix <span class="sy0">|=</span> 0x10<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">(</span><span class="br0">(</span>green <span class="sy0">&amp;</span> 0x80<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span>
		prefix <span class="sy0">|=</span> 0x08<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">(</span><span class="br0">(</span>green <span class="sy0">&amp;</span> 0x40<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span>
		prefix <span class="sy0">|=</span> 0x04<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">(</span><span class="br0">(</span>red <span class="sy0">&amp;</span> 0x80<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span>
		prefix <span class="sy0">|=</span> 0x02<span class="sy0">;</span>
	<span class="kw1">if</span><span class="br0">(</span><span class="br0">(</span>red <span class="sy0">&amp;</span> 0x40<span class="br0">)</span> <span class="sy0">==</span> <span class="nu0">0</span><span class="br0">)</span>
		prefix <span class="sy0">|=</span> 0x01<span class="sy0">;</span>
	sendByte<span class="br0">(</span>prefix<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>blue<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>green<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>red<span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
exports.<span class="me1">setColorRGB</span> <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span>led<span class="sy0">,</span>red<span class="sy0">,</span>green<span class="sy0">,</span>blue<span class="br0">)</span><span class="br0">{</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	<span class="kw1">for</span><span class="br0">(</span><span class="kw1">var</span> i <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span> i <span class="sy0">&lt;</span> led<span class="sy0">;</span> i<span class="sy0">++</span> <span class="br0">)</span><span class="br0">{</span>
		setColor<span class="br0">(</span>red<span class="sy0">,</span>green<span class="sy0">,</span>blue<span class="br0">)</span><span class="sy0">;</span>
	<span class="br0">}</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	sendByte<span class="br0">(</span>0x00<span class="br0">)</span><span class="sy0">;</span>
	console.<span class="me1">log</span><span class="br0">(</span><span class="st0">"set rgb"</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span>
test <span class="sy0">=</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
	initpins<span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    while<span class="br0">(</span><span class="nu0">1</span><span class="br0">)</span><span class="br0">{</span>
	console.<span class="me1">log</span><span class="br0">(</span><span class="st0">"loop"</span><span class="br0">)</span><span class="sy0">;</span>
        setColorRGB<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span>
        setColorRGB<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span>
        setColorRGB<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">255</span><span class="br0">)</span>
        setColorRGB<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="br0">)</span>
        setColorRGB<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">0</span><span class="sy0">,</span> <span class="nu0">255</span><span class="br0">)</span>
        setColorRGB<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">0</span><span class="br0">)</span>
        setColorRGB<span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="sy0">,</span> <span class="nu0">255</span><span class="br0">)</span>
	<span class="br0">}</span>
<span class="br0">}</span></pre></div></div>
<p>Create a new file named shadow.js.
</p>
<pre>
#vim shadow.js
</pre>
<p>Copy the following code to the new file.
</p>
<div class="mw-geshi mw-code mw-content-ltr container" dir="ltr"><div class="javascript source-javascript"><pre class="de1"><span class="kw1">var</span> awsIot <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'..'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> net <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'net'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> rgbled <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'./rgbled.js'</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> exec <span class="sy0">=</span> require<span class="br0">(</span><span class="st0">'child_process'</span><span class="br0">)</span>.<span class="me1">exec</span><span class="sy0">;</span>	
<span class="kw1">var</span> myThingName <span class="sy0">=</span> <span class="st0">'temperature'</span><span class="sy0">;</span>
<span class="kw1">var</span> thingShadows <span class="sy0">=</span> awsIot.<span class="me1">thingShadow</span><span class="br0">(</span><span class="br0">{</span>
   keyPath<span class="sy0">:</span> <span class="st0">'/var/lib/cloud9/examples/aws-iot-device-sdk-js/awsCerts/private.pem.key'</span><span class="sy0">,</span>
  certPath<span class="sy0">:</span> <span class="st0">'/var/lib/cloud9/examples/aws-iot-device-sdk-js/awsCerts/certificate.pem.crt'</span><span class="sy0">,</span>
    caPath<span class="sy0">:</span> <span class="st0">'/var/lib/cloud9/examples/aws-iot-device-sdk-js/awsCerts/root-CA.crt'</span><span class="sy0">,</span>
  clientId<span class="sy0">:</span> <span class="st0">'myAwsClientId'</span><span class="sy0">,</span>
    region<span class="sy0">:</span> <span class="st0">'us-west-2'</span>
<span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
<span class="kw1">var</span> HOST <span class="sy0">=</span> <span class="st0">'127.0.0.1'</span><span class="sy0">;</span>
<span class="kw1">var</span> PORT <span class="sy0">=</span> <span class="nu0">7000</span><span class="sy0">;</span>
<span class="kw1">var</span> temperature <span class="sy0">=</span> <span class="nu0">25</span><span class="sy0">;</span>
<span class="kw1">var</span> red <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">var</span> green <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="kw1">var</span> blue <span class="sy0">=</span> <span class="nu0">0</span><span class="sy0">;</span>
<span class="co1">// Create a server instance, and chain the listen function to it</span>
net.<span class="me1">createServer</span><span class="br0">(</span><span class="kw1">function</span><span class="br0">(</span>socket<span class="br0">)</span> <span class="br0">{</span>
    console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'CONNECTED: '</span> <span class="sy0">+</span> socket.<span class="me1">remoteAddress</span> <span class="sy0">+</span><span class="st0">':'</span><span class="sy0">+</span> socket.<span class="me1">remotePort</span><span class="br0">)</span><span class="sy0">;</span>
            <span class="co1">// Add a 'data' event handler to this instance of socket</span>
    socket.<span class="me1">on</span><span class="br0">(</span><span class="st0">'data'</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span>data<span class="br0">)</span> <span class="br0">{</span>
        console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'DATA '</span> <span class="sy0">+</span> socket.<span class="me1">remoteAddress</span> <span class="sy0">+</span> <span class="st0">': '</span> <span class="sy0">+</span> data<span class="br0">)</span><span class="sy0">;</span>
        temperature <span class="sy0">=</span> data.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span>.<span class="me1">substr</span><span class="br0">(</span><span class="nu0">0</span><span class="sy0">,</span><span class="nu0">5</span><span class="br0">)</span><span class="sy0">;</span>
        socket.<span class="me1">write</span><span class="br0">(</span><span class="st0">'This is your request: "'</span> <span class="sy0">+</span> data <span class="sy0">+</span> <span class="st0">'"'</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="co1">// Add a 'close' event handler to this instance of socket</span>
    socket.<span class="me1">on</span><span class="br0">(</span><span class="st0">'close'</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span>data<span class="br0">)</span> <span class="br0">{</span>
        console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'Socket connection closed... '</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
<span class="br0">}</span><span class="br0">)</span>.<span class="me1">listen</span><span class="br0">(</span>PORT<span class="sy0">,</span> HOST<span class="br0">)</span><span class="sy0">;</span>
<span class="co1">//</span>
<span class="co1">// Thing shadow state</span>
<span class="co1">//</span>
<span class="kw1">var</span> rgbLedLampState <span class="sy0">=</span> <span class="br0">{</span><span class="st0">"state"</span><span class="sy0">:</span><span class="br0">{</span><span class="st0">"desired"</span><span class="sy0">:</span><span class="br0">{</span><span class="st0">"red"</span><span class="sy0">:</span><span class="nu0">187</span><span class="sy0">,</span><span class="st0">"green"</span><span class="sy0">:</span><span class="nu0">114</span><span class="sy0">,</span><span class="st0">"blue"</span><span class="sy0">:</span><span class="nu0">222</span><span class="sy0">,</span>value<span class="sy0">:</span><span class="nu0">25</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span><span class="sy0">;</span>
 
<span class="co1">//</span>
<span class="co1">// Client token value returned from thingShadows.update() operation</span>
<span class="co1">//</span>
<span class="kw1">var</span> clientTokenUpdate<span class="sy0">;</span>
 
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'connect'</span><span class="sy0">,</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
<span class="co1">//</span>
<span class="co1">// After connecting to the AWS IoT platform, register interest in the</span>
<span class="co1">// Thing Shadow named 'RGBLedLamp'.</span>
<span class="co1">//</span>
    thingShadows.<span class="me1">register</span><span class="br0">(</span> myThingName <span class="br0">)</span><span class="sy0">;</span>
<span class="co1">//</span>
<span class="co1">// 2 seconds after registering, update the Thing Shadow named </span>
<span class="co1">// 'RGBLedLamp' with the latest device state and save the clientToken</span>
<span class="co1">// so that we can correlate it with status or timeout events.</span>
<span class="co1">//</span>
<span class="co1">// Note that the delay is not required for subsequent updates; only</span>
<span class="co1">// the first update after a Thing Shadow registration using default</span>
<span class="co1">// parameters requires a delay.  See API documentation for the update</span>
<span class="co1">// method for more details.</span>
<span class="co1">//</span>
	exec<span class="br0">(</span><span class="st0">'python python_sensor.py'</span><span class="sy0">,</span><span class="kw1">function</span><span class="br0">(</span>error<span class="sy0">,</span>stdout<span class="sy0">,</span>stderr<span class="br0">)</span><span class="br0">{</span>
    		<span class="kw1">if</span><span class="br0">(</span>stdout.<span class="me1">length</span> <span class="sy0">&gt;</span><span class="nu0">1</span><span class="br0">)</span><span class="br0">{</span>
        		console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'you offer args:'</span><span class="sy0">,</span>stdout<span class="br0">)</span><span class="sy0">;</span>
    		<span class="br0">}</span><span class="kw1">else</span> <span class="br0">{</span>
        		console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'you don<span class="es0">\'</span>t offer args'</span><span class="br0">)</span><span class="sy0">;</span>
    		<span class="br0">}</span>
    		<span class="kw1">if</span><span class="br0">(</span>error<span class="br0">)</span> <span class="br0">{</span>
        		console.<span class="me1">info</span><span class="br0">(</span><span class="st0">'stderr : '</span><span class="sy0">+</span>stderr<span class="br0">)</span><span class="sy0">;</span>
    		<span class="br0">}</span><span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
	rgbled.<span class="me1">initpins</span><span class="br0">(</span><span class="br0">)</span><span class="sy0">;</span>
    setTimeout<span class="br0">(</span> <span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span> <span class="br0">{</span>
       clientTokenUpdate <span class="sy0">=</span> thingShadows.<span class="me1">update</span><span class="br0">(</span>myThingName<span class="sy0">,</span> rgbLedLampState <span class="br0">)</span><span class="sy0">;</span>
       <span class="br0">}</span><span class="sy0">,</span> <span class="nu0">2000</span> <span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
setInterval<span class="br0">(</span><span class="kw1">function</span><span class="br0">(</span><span class="br0">)</span><span class="br0">{</span>
        new_data <span class="sy0">=</span> <span class="br0">{</span><span class="st0">"state"</span><span class="sy0">:</span><span class="br0">{</span><span class="st0">"desired"</span><span class="sy0">:</span><span class="br0">{</span><span class="st0">"red"</span><span class="sy0">:</span><span class="nu0">187</span><span class="sy0">,</span><span class="st0">"green"</span><span class="sy0">:</span><span class="nu0">114</span><span class="sy0">,</span><span class="st0">"blue"</span><span class="sy0">:</span><span class="nu0">222</span><span class="sy0">,</span>value<span class="sy0">:</span>temperature.<span class="me1">toString</span><span class="br0">(</span><span class="br0">)</span><span class="br0">}</span><span class="br0">}</span><span class="br0">}</span><span class="sy0">;</span>
        <span class="co1">//new_data = {"state":{"desired":{"value":temperature.toString()}}};</span>
        console.<span class="me1">log</span><span class="br0">(</span>new_data<span class="br0">)</span><span class="sy0">;</span>
       clientTokenUpdate <span class="sy0">=</span> thingShadows.<span class="me1">update</span><span class="br0">(</span>myThingName<span class="sy0">,</span> new_data <span class="br0">)</span>
<span class="br0">}</span><span class="sy0">,</span><span class="nu0">2000</span><span class="br0">)</span><span class="sy0">;</span>
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'status'</span><span class="sy0">,</span> 
    <span class="kw1">function</span><span class="br0">(</span>thingName<span class="sy0">,</span> stat<span class="sy0">,</span> clientToken<span class="sy0">,</span> stateObject<span class="br0">)</span> <span class="br0">{</span>
       console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'received '</span><span class="sy0">+</span>stat<span class="sy0">+</span><span class="st0">' on '</span><span class="sy0">+</span>thingName<span class="sy0">+</span><span class="st0">': '</span><span class="sy0">+</span>
                   JSON.<span class="me1">stringify</span><span class="br0">(</span>stateObject<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'delta'</span><span class="sy0">,</span> 
    <span class="kw1">function</span><span class="br0">(</span>thingName<span class="sy0">,</span> stateObject<span class="br0">)</span> <span class="br0">{</span>
       console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'received delta '</span><span class="sy0">+</span><span class="st0">' on '</span><span class="sy0">+</span>thingName<span class="sy0">+</span><span class="st0">': '</span><span class="sy0">+</span>
                   JSON.<span class="me1">stringify</span><span class="br0">(</span>stateObject<span class="br0">)</span><span class="br0">)</span><span class="sy0">;</span>
        <span class="co1">//console.log(stateObject["state"]);</span>
	<span class="kw1">if</span><span class="br0">(</span>stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"red"</span><span class="br0">]</span>		<span class="sy0">!=</span> red <span class="sy0">||</span>
	   stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"green"</span><span class="br0">]</span> 	<span class="sy0">!=</span> green<span class="sy0">||</span>
	  stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"blue"</span><span class="br0">]</span>   	<span class="sy0">!=</span> blue<span class="br0">)</span>
        	rgbled.<span class="me1">setColorRGB</span><span class="br0">(</span><span class="nu0">1</span><span class="sy0">,</span>stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"red"</span><span class="br0">]</span><span class="sy0">,</span>
                        stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"green"</span><span class="br0">]</span><span class="sy0">,</span>
                        stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"blue"</span><span class="br0">]</span><span class="br0">)</span><span class="sy0">;</span>
 
	red <span class="sy0">=</span> stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"red"</span><span class="br0">]</span><span class="sy0">;</span>
	green <span class="sy0">=</span> stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"green"</span><span class="br0">]</span><span class="sy0">;</span>
	blue <span class="sy0">=</span> stateObject<span class="br0">[</span><span class="st0">"state"</span><span class="br0">]</span><span class="br0">[</span><span class="st0">"blue"</span><span class="br0">]</span><span class="sy0">;</span>
    <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span>
 
thingShadows.<span class="me1">on</span><span class="br0">(</span><span class="st0">'timeout'</span><span class="sy0">,</span>
    <span class="kw1">function</span><span class="br0">(</span>thingName<span class="sy0">,</span> clientToken<span class="br0">)</span> <span class="br0">{</span>
       console.<span class="me1">log</span><span class="br0">(</span><span class="st0">'received timeout '</span><span class="sy0">+</span><span class="st0">' on '</span><span class="sy0">+</span>thingName<span class="sy0">+</span><span class="st0">': '</span><span class="sy0">+</span>
                   clientToken<span class="br0">)</span><span class="sy0">;</span>
    <span class="br0">}</span><span class="br0">)</span><span class="sy0">;</span></pre></div></div>
<p>Please note that, the value of <i><b>myThingName</b></i> in the 5 line should be the same as your Thing name that you have already create before in your AWS account.
</p>
<h4>  Run the Code </h4>
<p>When the BBG reboot done, run the code.
</p>
<pre>
# cd examples/aws-iot-device-sdk-js/examples/
# node shadow.js
</pre>
<p><img src="img/BbgAWSRun.png" width="600"/>
</p>
<h3> View Result</h3>
<p>Then let's open <a href="https://aws.amazon.com/iot/">AWS IoT</a> website, sign in to your account. And click the thing you created minutes ago.
Now you can see the temperature was upload to website.
</p><p><img src="img/BbgAWSResult.png" width="600"/>
</p><p>If you want change the grove chainable led color. You can update the shadow value. eg:
</p><p><img src="img/BbgAWSChange.png" width="600"/>
</p><p>You can see the BBG get the new RGB value.
</p><p><img src="img/BbgAWSRGB.png" width="600"/>
</p><p>And the Grove - Chainable RGB LED alse turned into green.
</p><p><img src="img/BbgAWSGreen.png" width="600"/>
</p><p>Put hand on <a href="https://docs.aws.amazon.com/iot/latest/developerguide/iot-dg.pdf">AWS IoT Services Getting Started Guide</a> to get more information about AWS IoT.
</p>
<h2>  Troubleshoot </h2>
<h3>  Can't open 192.168.7.2 </h3>
<p><br/>
Please update the latest software if you can't open 192.168.7.2. 
</p><p><b>Step #1: Download the latest software image. <br/></b>
<font color="Blue"><i>Updated time: 11/15/15</i></font> <br/>
Download the latest image from <a href="https://drive.google.com/file/d/0BwBIy7Eq4Nucd3NTaUkzS0dtT2s/view?usp=sharing">google drive</a>
<br/>
<br/>
<img src="img/AWS_BBG_4.png" width="700"/>
<br/>
<br/>
<b>Step #2: Install compression utility<br/></b>
Download and install <a href="http://www.7-zip.org/download.html">7-zip</a>.
<br/>
<img src="img/AWS_BBG_1.png" width="600"/>
<br/>
<br/>
<b>Step #3: Decompress the image<br/></b>
Use 7-zip to decompress the .img file on the desktop or other folder.
<br/>
<br/>
<b>Step #4: Install SD card programming utility<br/></b>
Download and install <a href="http://sourceforge.net/projects/win32diskimager/files/latest/download">Image Writer for Windows</a>. Be sure to download the binary distribution.
<br/>
<img src="img/AWS_BBG_2.png" width="600"/>
<br/>
<br/>
<b>Step #5: Connect SD card to your computer<br/></b>
Use an 8G microSD card at least to SD adapter or a USB adapter to connect the SD card to your computer.
<br/>
<br/>
<b>Step #6: Write the image to your SD card<br/></b>
Use either the Ubuntu Image Writer or instructions on its page to write the decompressed image to your SD card.
<br/>
<br/>
<img src="img/AWS_BBG_3.png" width="435"/>
<br/>
<br/>
<i><font color="Red">Note: You may see a warning about damaging your device. This is fine to accept as long as you are pointing to your SD card for writing.</font></i>
<br/>
<i><font color="Red">Note: You should not have your BeagleBone connected to your computer at this time.</font></i>
</p><p><br/>
<b>Step #7: Eject the SD card<br/></b>
Eject the newly programmed SD card.
<br/>
<br/>
<b>Step #8: Boot your board off of the SD card<br/></b>
Insert SD card into your (powered-down) board and apply power, either by the USB cable or 5V adapter. You'll see flash led if getting started, and this reboot will take up to 10 minutes. The latest Debian flasher images automatically power down the board upon completion. Power-down your board, remove the SD card and apply power again to be complete.
</p><p>Good Luck.
</p>
<h2>  Tech Support </h2>
<p>Please post any question on the <a href="http://beagleboard.org/Community/Forums">forum</a>.
</p>
<h2> Firmware update </h2>
<p><a href="https://drive.google.com/file/d/0BwBIy7Eq4Nucd3NTaUkzS0dtT2s/view?usp=sharing">Updated by 11/15/15</a>:
</p>
<ul><li> Fix the problem of not being able to access 192.168.7.2
</li><li> Win 10 supported now
</li></ul>
<h2> Resources</h2>
<ul><li> <a href="res/AWS_IoT_Developer_Guide.pdf">【PDF】AWS IoT Developer Guide</a>
</li><li> <a href="res/AWS_User_Guide_for_BBG.pdf">【PDF】AWS User Guide for BBG</a>
</li><li> <a href="/Grove_IoT_Starter_Kits_Powered_by_AWS">【Wiki】Main Page for Grove IoT Starter Kits Powered by AWS</a>
</li><li> <a href="https://github.com/Seeed-Studio/AWS_SDK_for_BBG">【Github】AWS SDK for BeagleBone Green kit</a>
</li><li> <a href="https://github.com/Seeed-Studio/Grove_Starter_Kit_for_BBG">【Github】Libraries for BeagleBone Green kit</a>
</li><li> <a href="/Beaglebone_green">Wiki:BeagleBone Green</a>
</li><li> <a href="http://beagleboard.org/getting-started">Main page of Beagleboard</a>
</li><li> <a href="/Grove-I2C_ADC">Wiki:Grove - I2C ADC</a>
</li><li> <a href="/index.php-title=Twig-I2C_Hub">Wiki:Grove - I2C Hub</a>
</li><li> <a href="/Grove-Relay">Wiki:Grove - Relay</a>
</li><li> <a href="/Grove-Buzzer">Wiki:Grove - Buzzer</a>
</li><li> <a href="/Grove-OLED_Display_96x96">Wiki:Grove - OLED Dislay 96*96</a>
</li><li> <a href="/Grove-Button">Wiki:Grove - Button</a>
</li><li> <a href="/Grove-Temperature_Sensor_V1.2">Wiki:Grove - Temperature sensor v1.2</a>
</li><li> <a href="/index.php-title=Twig-Sound_Sensor">Wiki:Grove - Sound sensor</a>
</li><li> <a href="/Grove-3-Axis_Digital_Accelerometer_ADXL345">Wiki:Grove - 3-Axis Digital Accelerometer ADXL345</a>
</li><li> <a href="/index.php-title=Twig-Chainable_RGB_LED">Wiki:Grove - Chainable RGB LED</a>
</li></ul>
<p><br/>
</p>
<h2> Help us to make it better </h2>
<p><iframe frameborder="0" height="500" src="https://www.surveymonkey.com/r/DBZZZN8" width="500"></iframe>
</p>
Copyright (c) 2008-2016 Seeed Development Limited (<a href="http://www.seeedstudio.com">www.seeedstudio.com</a> / <a href="http://www.seeed.cc">www.seeed.cc</a>)<h6>This static html page was created from http://www.seeedstudio.com/wiki</h6></div></body></html>