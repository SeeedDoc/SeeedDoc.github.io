<html><head><meta name="viewport" content="width=device-width, initial-scale=1"><link href=//fonts.googleapis.com/css?family=Raleway:400,300,600 rel=stylesheet type=text/css><link rel="stylesheet" type="text/css" href="../common/css/normalize.css"><link rel="stylesheet" type="text/css" href="../common/css/skeleton.css"><link rel="stylesheet" type="text/css" href="../common/css/wiki.css"><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><title>Xadow - RTC</title><meta charset="utf-8"/></head><body><div class"container"><a href="../index.html"><img src="../common/logo.png"/></a></div><div class="mw-content-ltr container" dir="ltr" id="mw-content-text" lang="en"><h1>Xadow - RTC</h1>
<div class="thumb tright"><div class="thumbinner" style="width:402px;"><img src="img/Xadow_RTC_01.jpg" width="400"/> <div class="thumbcaption"></div></div></div>

<p>Sometimes, you always want to know what time it is. Whether I have missed the dating or not, or if it is the mealtime for my three months child. The RTC module can provide you a real-time clock. You can make the controller ask the module: hi,buddy, what time it is. At the same time, do not forget to install a small coin cell which can serve you for more than six mouths.<br/>
</p><p><br/>
</p>
<h2> Specification</h2>
<ul><li>Real-Time Clock (RTC) Counts Seconds,Minutes, Hours, Date of the Year, Month, Day of the week, and Year with Leap-Year Compensation 
</li><li>Can set as 12-hour format or 24-hour format
</li><li>Valid Up to 2100
</li><li>Dimensions: 25.43mm x 20.35mm
</li></ul>
<h2>  Caution </h2>
<p>In order to gain a robust performance, you must put a 3-Volt CR1220 lithium cell in the battery-holder. If you use the primary power only, the module may not work normally, because the crystal may not oscillate.
</p>
<h2> Demonstration </h2>
<p>The following sketch demonstrates a simple application of setting the time and reading it out.<br/>
<b>Hardware Installation:</b>
<br/><img src="img/XadwoRTC.jpg" width="600"/><br/>
Note: when connect Xadow RTC to Xadow Main Board, you should concern about the connection direction. The connection method is that the unfilled corner of one Xadow module need to connect to the right angle of another module(see four corners of each Xadow module).<br/>
<b>Demo code as show below:</b>
</p>
<pre>
#include &lt;Wire.h&gt;
#define DS1337_CTRL_ID 0x68
 
unsigned char  second,minute,hour;
unsigned char  week,day,month;
unsigned int year;

void setup()
{
  Wire.begin();
  Serial.begin(38400);
  while (!Serial) {
   Â ; // wait for serial port to connect. Needed for Leonardo only
  }
   
 fillByYMD(2013,6,17);//Jun 19,2013
 fillByHMS(23,15,43);//23:15 43"
 fillWeek(1);//Monday
 setTime();
}

void loop()
{
       readTime();
  	Serial.print(year+2000, DEC);
        Serial.print("/");
        Serial.print(month, DEC);
         Serial.print("/");
        Serial.print(day, DEC);
       	Serial.print("  ");
        Serial.print(hour, DEC);
	Serial.print(":");
	Serial.print(minute, DEC);
	Serial.print(":");
	Serial.print(second, DEC);
	Serial.print("	");
	switch (week)// Friendly printout the weekday
	{
		case 1:
		  Serial.print("MON");
		  break;
		case 2:
		  Serial.print("TUE");
		  break;
		case 3:
		  Serial.print("WED");
		  break;
		case 4:
		  Serial.print("THU");
		  break;
		case 5:
		  Serial.print("FRI");
		  break;
		case 6:
		  Serial.print("SAT");
		  break;
		case 7:
		  Serial.print("SUN");
		  break;
	}
	Serial.println("  ");
        delay(1000);
}
/*Function: Read time and date from RTC	*/
void readTime(void)
{
  // use the Wire lib to connect to tho rtc
  // reset the register pointer to zero
  Wire.beginTransmission(DS1337_CTRL_ID);
  Wire.write(0x00);
  Wire.endTransmission();

  // request the 7 bytes of data    (secs, min, hr, dow, date. mth, yr)
  Wire.requestFrom(DS1337_CTRL_ID, 7);
	// A few of these need masks because certain bits are control bits
	second	   = bcdToDec(Wire.read() &amp; 0x7f);
	minute	   = bcdToDec(Wire.read());
	hour	   = bcdToDec(Wire.read() &amp; 0x3f);// Need to change this if 12 hour am/pm
	week  = bcdToDec(Wire.read());
	day = bcdToDec(Wire.read());
	month      = bcdToDec(Wire.read());
	year	   = bcdToDec(Wire.read());
}
/*Function: Write the time that includes the date to the RTC chip */
void  setTime(void)
{
	Wire.beginTransmission(DS1337_CTRL_ID);
	Wire.write(0x00);
        Wire.write(decToBcd(second));// 0 to bit 7 starts the clock
	Wire.write(decToBcd(minute));
	Wire.write(decToBcd(hour));  // If you want 12 hour am/pm you need to set bit 6 
	Wire.write(decToBcd(week));
	Wire.write(decToBcd(day));
	Wire.write(decToBcd(month));
	Wire.write(decToBcd(year));
	Wire.endTransmission();
}
 
unsigned char decToBcd(unsigned char val)
{
	return ( (val/10*16) + (val%10) );
}

//Convert binary coded decimal to normal decimal numbers
unsigned char  bcdToDec(unsigned char val)
{
	return ( (val/16*10) + (val%16) );
}
void fillByYMD(unsigned int _year, unsigned char _month, unsigned char _day)
{
	year = _year-2000;
	month = _month;
	day = _day;
}
void fillWeek(unsigned char _dow)
{
	week = _dow;
}
void  fillByHMS(unsigned char _hour, unsigned char _minute, unsigned char _second)
{
	// assign variables
	hour = _hour;
	minute = _minute;
	second = _second;
}</pre>
<ul><li>Set the time. Put function arguments change to current date/time. The attention should be paid to the arguments format. 
</li></ul>
<pre> fillByYMD(2013,6,17);//Jun 17,2013
 fillByHMS(23,15,43);//23:15 43"
 fillWeek(1);//Monday</pre>
<ul><li>The output result:  
</li></ul>
<pre> <br/><img src="img/Xadow-RTC_Result.jpg" width="331"/><br/>
</pre>
<p>The output time is changing like the clock. Once you set a time, RTC will update the clock time data constantly. Then you need to comment out the code as show below and re-upload. A Real-Time Clock appears . 
</p>
<pre>//setTime();</pre>
<h2>  Resources </h2>
<ul><li><a href="res/Xadow_RTC.zip">Xadow RTC Eagle File</a><br/>
</li><li><a href="res/DS1307.pdf">RTC DS1307 Datasheet</a>
</li></ul>
Copyright (c) 2008-2016 Seeed Development Limited (<a href="http://www.seeedstudio.com">www.seeedstudio.com</a> / <a href="http://www.seeed.cc">www.seeed.cc</a>)<h6>This static html page was created from http://www.seeedstudio.com/wiki</h6></div></body></html>